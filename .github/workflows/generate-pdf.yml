name: 生成外卖活动方案PDF

on:
  workflow_dispatch:
    inputs:
      store_name:
        description: '店铺名称'
        required: true
        type: string
      platform:
        description: '平台类型'
        required: true
        type: choice
        options:
          - eleme
          - meituan
          - both

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 安装中文字体
        run: |
          sudo apt-get update
          sudo apt-get install -y fonts-wqy-microhei

      - name: 设置 Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 安装依赖
        run: |
          pip install reportlab

      - name: 生成PDF
        run: |
          python backend/app/services/pdf_generator.py "${{ inputs.store_name }}" "${{ inputs.platform }}" ./output

      - name: 上传PDF
        uses: actions/upload-artifact@v4
        with:
          name: activity-plan-pdf
          path: ./output/*.pdf
          retention-days: 7
