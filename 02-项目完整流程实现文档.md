# 商家店铺活动方案生成器 - 项目完整流程实现文档

> 版本: v3.0
> 更新日期: 2026-01-28
> 品牌: 呈尚策划

---

## 目录

1. [项目概述](#1-项目概述)
2. [技术架构](#2-技术架构)
3. [项目目录结构](#3-项目目录结构)
4. [活动数据配置](#4-活动数据配置)
5. [后端实现 - PDF生成服务](#5-后端实现---pdf生成服务)
6. [前端实现 - UI改造](#6-前端实现---ui改造)
7. [API接口设计](#7-api接口设计)
8. [GitHub Actions 部署](#8-github-actions-部署)
9. [开发计划与任务清单](#9-开发计划与任务清单)
10. [附录](#10-附录)

---

## 1. 项目概述

### 1.1 项目背景

为外卖代运营场景打造的活动方案生成工具，帮助运营人员快速为商家生成专业的平台活动策划方案 PDF 文档。

### 1.2 项目目标

- 用户在网页输入店铺名称
- 选择目标平台（饿了么/美团/双平台）
- 系统生成带有"呈尚策划"品牌标识的专业 PDF 活动方案
- 支持在线预览和下载

### 1.3 核心特点

| 特点 | 说明 |
|-----|------|
| **无需 API 调用** | 活动内容全部内置，无需调用外部 AI 接口 |
| **品牌定制** | 顶部和底部带有"呈尚策划"品牌标识 |
| **双平台支持** | 支持饿了么、美团、双平台三种模式 |
| **长页输出** | 单页长图式 PDF，无翻页裁剪 |
| **专业排版** | 活动表格、详解、效果卡片、执行建议 |
| **GitHub Actions** | 支持云端自动化部署和生成 |

### 1.4 支持平台

| 平台 | 标识 | 品牌色 | 说明 |
|-----|------|-------|------|
| 饿了么 | `eleme` | #0097FF | 蓝色系 |
| 美团外卖 | `meituan` | #FFCA28 | 黄色系 |
| 双平台 | `both` | - | 同时包含两个平台方案 |

---

## 2. 技术架构

### 2.1 架构对比

#### 旧架构（已废弃）
```
用户输入 → 前端 → Gemini API → 动态生成内容 → 前端渲染 → html2canvas → PDF
```
**问题**: 依赖外部 API，成本高，响应慢，内容不可控

#### 新架构（当前）
```
用户输入 → 前端 → 后端 Python → 内置模板数据 → reportlab 渲染 → PDF 文件
```
**优势**: 无 API 依赖，响应快，内容可控，可部署到 GitHub Actions

### 2.2 整体架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                           用户浏览器                                 │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                    React 前端应用                              │ │
│  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │   │  店铺名输入  │  │  平台选择   │  │  预览 & 下载按钮    │  │ │
│  │   └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                │ HTTP POST /api/generate
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      Python FastAPI 后端                             │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                     PDF 生成服务                               │ │
│  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │   │ 内置活动数据 │  │ reportlab   │  │  品牌模板渲染       │  │ │
│  │   │ (饿了么/美团)│  │ PDF 引擎    │  │  (呈尚策划)         │  │ │
│  │   └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                                │                                    │
│                                ▼                                    │
│                    ┌─────────────────────┐                         │
│                    │   output/*.pdf      │                         │
│                    │   生成的PDF文件      │                         │
│                    └─────────────────────┘                         │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.3 技术栈选型

| 层级 | 技术 | 版本 | 说明 |
|-----|------|------|------|
| **前端框架** | React | 19.x | 组件化开发 |
| **前端语言** | TypeScript | 5.8.x | 类型安全 |
| **前端构建** | Vite | 6.x | 快速热更新 |
| **前端样式** | Tailwind CSS | 内联 | 快速样式开发 |
| **前端图标** | Lucide React | 0.563.x | 图标库 |
| **后端框架** | FastAPI | 0.109.x | 高性能异步 API |
| **PDF 生成** | reportlab | 4.0.x | 专业 PDF 渲染 |
| **部署平台** | GitHub Actions | - | CI/CD 自动化 |

---

## 3. 项目目录结构

### 3.1 完整目录结构

```
store-plan-generator/
├── frontend/                          # 前端项目 (已存在，需改造)
│   ├── index.html                     # HTML 入口
│   ├── index.tsx                      # React 入口
│   ├── App.tsx                        # 主应用组件 [需改造]
│   ├── types.ts                       # TypeScript 类型定义 [需改造]
│   ├── components/
│   │   ├── Header.tsx                 # 页头组件 [需改造: 移除AI标签]
│   │   ├── PlatformSelector.tsx       # 平台选择器 [需改造: 饿了么/美团]
│   │   └── PlanPreview.tsx            # 方案预览组件 [可选保留]
│   ├── services/
│   │   ├── apiService.ts              # API 服务 [新建: 替换geminiService]
│   │   └── pdfService.ts              # PDF 下载服务 [保留]
│   ├── package.json
│   ├── tsconfig.json
│   ├── vite.config.ts                 # Vite 配置 [需改造: 移除API_KEY]
│   └── .env.local                     # 环境变量 [需改造]
│
├── backend/                           # 后端项目 [新建]
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py                    # FastAPI 入口
│   │   ├── api/
│   │   │   ├── __init__.py
│   │   │   └── routes.py              # API 路由
│   │   ├── services/
│   │   │   ├── __init__.py
│   │   │   └── pdf_generator.py       # PDF 生成核心服务
│   │   └── data/
│   │       ├── __init__.py
│   │       └── activity_templates.py  # 内置活动数据模板
│   ├── fonts/                         # 中文字体文件
│   │   └── SourceHanSansCN-Regular.ttf
│   ├── output/                        # PDF 输出目录
│   ├── requirements.txt               # Python 依赖
│   └── run.py                         # 启动脚本
│
├── .github/
│   └── workflows/
│       └── generate-pdf.yml           # GitHub Actions 工作流
│
└── docs/
    └── 02-项目完整流程实现文档.md      # 本文档
```

### 3.2 现有前端文件清单

| 文件 | 状态 | 改造说明 |
|-----|------|---------|
| `App.tsx` | 需改造 | 移除 Gemini 调用，改为调用后端 API |
| `types.ts` | 需改造 | 更新类型定义，匹配新数据结构 |
| `Header.tsx` | 需改造 | 移除 "AI 驱动" 标签 |
| `PlatformSelector.tsx` | 需改造 | 将淘宝闪购改为饿了么 |
| `PlanPreview.tsx` | 可选 | 可保留用于前端预览，或完全依赖 PDF |
| `geminiService.ts` | 删除 | 不再需要 |
| `pdfService.ts` | 保留 | 前端 PDF 下载功能 |
| `vite.config.ts` | 需改造 | 移除 GEMINI_API_KEY 配置 |

---

## 4. 活动数据配置

### 4.1 饿了么平台活动配置

#### 活动总览表

| 活动名称 | 活动设置 | 目的说明 |
|---------|---------|---------|
| 爆单红包 | 通用红包，40元以下商家补贴5元 | 获取平台流量扶持，提升店铺曝光 |
| 减配送费 | 减4-5元，达到店铺免配送 | 降低下单门槛，提升转化率 |
| 优评返券 | 满20减2元 | 刺激顾客好评，提升评分和曝光 |
| 下单返券 | 满20减2元 | 促进二次消费，提升复购率 |
| 集点返券 | 30天内下3单返3元无门槛券 | 培养老客忠诚度，提升店铺权重 |

#### 活动详解数据

```python
ELEME_DETAILS = [
    ("爆单红包", "报名通用红包，订单40元以下商家补贴5元，获得平台流量入口曝光机会"),
    ("减配送费", "减免4-5元配送费，使顾客实付配送费接近0元，消除顾客下单顾虑"),
    ("优评返券", "顾客给出好评后自动发放满20减2元优惠券，激励好评提升店铺评分"),
    ("下单返券", "顾客完成订单后自动发放满20减2元优惠券，促进顾客二次下单"),
    ("集点返券", "30天内累计下单3次返3元无门槛券，培养老客户消费习惯，提升权重"),
]
```

### 4.2 美团平台活动配置

#### 活动总览表

| 活动名称 | 活动设置 | 目的说明 |
|---------|---------|---------|
| 天天神券 | 普通神券5元 | 获取平台流量扶持，提升店铺曝光 |
| 减配送费 | 减4-5元，达到店铺免配送 | 降低下单门槛，提升转化率 |
| 好评返券 | 满20减2元 | 刺激顾客好评，提升评分和曝光 |
| 下单返券 | 满20减2元 | 促进二次消费，提升复购率 |
| 集点返券 | 30天内下3单返3元无门槛券 | 培养老客忠诚度，提升店铺权重 |

#### 活动详解数据

```python
MEITUAN_DETAILS = [
    ("天天神券", "报名普通神券5元，获得美团首页神券入口流量，大幅提升曝光"),
    ("减配送费", "减免4-5元配送费，使顾客实付配送费接近0元，消除顾客下单顾虑"),
    ("好评返券", "顾客给出好评后自动发放满20减2元优惠券，激励好评提升店铺评分"),
    ("下单返券", "顾客完成订单后自动发放满20减2元优惠券，促进顾客二次下单"),
    ("集点返券", "30天内累计下单3次返3元无门槛券，培养老客户消费习惯，提升权重"),
]
```

### 4.3 通用执行建议

```python
TIPS = [
    ("合理定价", "确保菜品定价已包含活动成本，保证每单利润"),
    ("活动报名", "每月月初完成当月活动报名，确保活动连续性"),
    ("数据监控", "每周查看平台数据报表，关注各活动投入产出比"),
    ("避免叠加", "注意活动叠加规则，防止过度让利导致亏损"),
    ("定期复盘", "每月进行活动效果复盘，根据数据优化配置"),
]
```

### 4.4 效果预期数据

| 指标 | 预期提升 | 颜色标识 |
|-----|---------|---------|
| 曝光量提升 | 30%-50% | 平台主色 |
| 转化率提升 | 15%-25% | #048A81 |
| 复购率提升 | 20%-30% | #38A169 |
| 评分维护 | 稳步提升 | #C9A962 |

### 4.5 配色方案

```python
COLORS = {
    # 品牌色
    'brand_dark': '#1A1A2E',      # 深色背景
    'brand_gold': '#C9A962',      # 金色装饰

    # 饿了么品牌色
    'eleme_blue': '#0097FF',      # 主色
    'eleme_dark': '#0078CC',      # 深色
    'eleme_light': '#E6F4FF',     # 浅色背景

    # 美团品牌色
    'meituan_yellow': '#FFCA28',  # 主色
    'meituan_dark': '#F5A623',    # 深色
    'meituan_light': '#FFF8E1',   # 浅色背景

    # 通用色
    'text_dark': '#1A1A2E',       # 深色文字
    'text_medium': '#4A5568',     # 中等文字
    'text_light': '#718096',      # 浅色文字
    'bg_light': '#F7FAFC',        # 浅色背景
    'border': '#E2E8F0',          # 边框色
    'accent': '#048A81',          # 强调色
    'success': '#38A169',         # 成功色
}
```

---

## 5. 后端实现 - PDF生成服务

### 5.1 依赖清单

**requirements.txt**
```
fastapi==0.109.0
uvicorn==0.27.0
reportlab==4.0.8
python-multipart==0.0.6
```

### 5.2 FastAPI 主入口

**app/main.py**
```python
# -*- coding: utf-8 -*-
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from app.api.routes import router
import os

app = FastAPI(
    title="店铺活动方案生成器",
    description="呈尚策划 - 外卖活动方案PDF生成服务",
    version="3.0.0"
)

# CORS 配置
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# 静态文件服务 (PDF 下载)
os.makedirs("output", exist_ok=True)
app.mount("/files", StaticFiles(directory="output"), name="files")

# API 路由
app.include_router(router, prefix="/api")

@app.get("/")
async def root():
    return {"message": "呈尚策划 - 活动方案生成器 API", "version": "3.0.0"}
```

### 5.3 API 路由实现

**app/api/routes.py**
```python
# -*- coding: utf-8 -*-
from fastapi import APIRouter, HTTPException
from fastapi.responses import FileResponse
from pydantic import BaseModel
from typing import Literal
from app.services.pdf_generator import generate_plan
import os

router = APIRouter()

class GenerateRequest(BaseModel):
    store_name: str
    platform: Literal["eleme", "meituan", "both"]

class GenerateResponse(BaseModel):
    success: bool
    filename: str
    download_url: str

@router.post("/generate", response_model=GenerateResponse)
async def generate_pdf(request: GenerateRequest):
    """
    生成活动方案 PDF

    - **store_name**: 店铺名称
    - **platform**: 平台类型 (eleme/meituan/both)
    """
    try:
        if not request.store_name.strip():
            raise HTTPException(status_code=400, detail="店铺名称不能为空")

        output_path = generate_plan(
            store_name=request.store_name,
            platform=request.platform,
            output_dir="output"
        )

        filename = os.path.basename(output_path)

        return GenerateResponse(
            success=True,
            filename=filename,
            download_url=f"/files/{filename}"
        )
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/download/{filename}")
async def download_pdf(filename: str):
    """下载 PDF 文件"""
    filepath = f"output/{filename}"
    if not os.path.exists(filepath):
        raise HTTPException(status_code=404, detail="文件不存在")
    return FileResponse(
        filepath,
        filename=filename,
        media_type="application/pdf"
    )

@router.get("/health")
async def health_check():
    """健康检查"""
    return {"status": "healthy", "service": "pdf-generator"}
```

### 5.4 PDF 生成器核心代码

**app/services/pdf_generator.py**

> 完整代码参考 `waimai-plan-generator` skill 中的 `generate_plan.py`

核心函数说明：

| 函数 | 说明 |
|-----|------|
| `register_chinese_fonts()` | 注册中文字体，支持多平台 |
| `draw_brand_header()` | 绘制呈尚策划品牌头部 |
| `draw_brand_footer()` | 绘制呈尚策划品牌底部 |
| `draw_platform_banner()` | 绘制平台横幅（饿了么蓝/美团黄） |
| `draw_store_name()` | 绘制店铺名称 |
| `draw_activity_table()` | 绘制活动配置表格 |
| `draw_activity_details()` | 绘制活动详解 |
| `draw_effects()` | 绘制效果预期卡片 |
| `draw_tips()` | 绘制执行建议 |
| `generate_single_platform_pdf()` | 生成单平台 PDF |
| `generate_both_platforms_pdf()` | 生成双平台 PDF |
| `generate_plan()` | 主入口函数 |

### 5.5 字体处理策略

```python
def register_chinese_fonts():
    """注册中文字体 - 多平台兼容"""
    font_options = [
        # Windows
        ("C:/Windows/Fonts/msyh.ttc", "MSYH"),
        ("C:/Windows/Fonts/simhei.ttf", "SimHei"),
        # macOS
        ("/System/Library/Fonts/PingFang.ttc", "PingFang"),
        # Linux (GitHub Actions)
        ("/usr/share/fonts/truetype/wqy/wqy-microhei.ttc", "WQY"),
        # 项目内置字体 (推荐)
        ("fonts/SourceHanSansCN-Regular.ttf", "SourceHan"),
    ]
    for font_path, font_name in font_options:
        if os.path.exists(font_path):
            try:
                pdfmetrics.registerFont(TTFont(font_name, font_path))
                return font_name
            except:
                continue
    return "Helvetica"  # 回退字体
```

### 5.6 启动脚本

**run.py**
```python
# -*- coding: utf-8 -*-
import uvicorn

if __name__ == "__main__":
    uvicorn.run(
        "app.main:app",
        host="0.0.0.0",
        port=8000,
        reload=True
    )
```

### 5.7 后端启动命令

```bash
# 开发模式
cd backend
pip install -r requirements.txt
python run.py

# 或使用 uvicorn 直接启动
uvicorn app.main:app --reload --port 8000
```

---

## 6. 前端实现 - UI改造

### 6.1 改造概述

现有前端基于 Gemini API 实现，需要改造为调用后端 API。

| 改造项 | 原实现 | 新实现 |
|-------|-------|-------|
| 数据来源 | Gemini API 动态生成 | 后端内置模板 |
| PDF 生成 | 前端 html2canvas | 后端 reportlab |
| 平台选项 | 美团/淘宝闪购/双平台 | 饿了么/美团/双平台 |
| API 密钥 | 需要 GEMINI_API_KEY | 无需任何密钥 |

### 6.2 类型定义改造

**types.ts**
```typescript
// 平台枚举 - 改为饿了么/美团
export enum Platform {
  ELEME = 'eleme',
  MEITUAN = 'meituan',
  BOTH = 'both'
}

// API 响应类型
export interface GenerateResponse {
  success: boolean;
  filename: string;
  download_url: string;
}

// 错误响应
export interface ErrorResponse {
  detail: string;
}
```

### 6.3 API 服务封装

**services/apiService.ts** (新建，替换 geminiService.ts)
```typescript
import { Platform, GenerateResponse } from '../types';

// 后端 API 地址
const API_BASE = import.meta.env.VITE_API_BASE || 'http://localhost:8000';

/**
 * 生成活动方案 PDF
 */
export async function generatePlan(
  storeName: string,
  platform: Platform
): Promise<GenerateResponse> {
  const response = await fetch(`${API_BASE}/api/generate`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      store_name: storeName,
      platform: platform,
    }),
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.detail || '生成失败');
  }

  return response.json();
}

/**
 * 获取完整下载 URL
 */
export function getDownloadUrl(downloadPath: string): string {
  return `${API_BASE}${downloadPath}`;
}

/**
 * 健康检查
 */
export async function healthCheck(): Promise<boolean> {
  try {
    const response = await fetch(`${API_BASE}/api/health`);
    return response.ok;
  } catch {
    return false;
  }
}
```

### 6.4 平台选择器改造

**components/PlatformSelector.tsx**
```typescript
import React from 'react';
import { Platform } from '../types';
import { ShoppingBag, Truck, Layers } from 'lucide-react';

interface PlatformSelectorProps {
  selected: Platform;
  onChange: (p: Platform) => void;
}

const PlatformSelector: React.FC<PlatformSelectorProps> = ({ selected, onChange }) => {

  const options = [
    // 改为饿了么/美团
    { id: Platform.ELEME, label: '饿了么', icon: Truck, color: 'text-blue-500' },
    { id: Platform.MEITUAN, label: '美团外卖', icon: ShoppingBag, color: 'text-yellow-500' },
    { id: Platform.BOTH, label: '双平台', icon: Layers, color: 'text-indigo-500' },
  ];

  return (
    <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 w-full">
      {options.map((opt) => {
        const isSelected = selected === opt.id;
        const Icon = opt.icon;

        return (
          <div
            key={opt.id}
            onClick={() => onChange(opt.id)}
            className={`
              relative group cursor-pointer rounded-xl p-4 border transition-all duration-300
              flex flex-col items-center justify-center gap-2
              ${isSelected
                ? 'bg-white border-primary-500 shadow-lg shadow-primary-500/10'
                : 'bg-slate-50 border-slate-200 hover:border-slate-300 hover:bg-white'}
            `}
          >
            {isSelected && (
              <div className="absolute top-2 right-2 w-2 h-2 rounded-full bg-primary-500 animate-pulse" />
            )}
            <div className={`p-2.5 rounded-lg transition-colors duration-300
              ${isSelected ? 'bg-primary-50' : 'bg-white shadow-sm'}`}>
              <Icon size={20} className={isSelected ? opt.color : 'text-slate-400'} />
            </div>
            <span className={`font-semibold text-sm ${isSelected ? 'text-slate-800' : 'text-slate-500'}`}>
              {opt.label}
            </span>
          </div>
        );
      })}
    </div>
  );
};

export default PlatformSelector;
```

### 6.5 主应用组件改造

**App.tsx** 核心改动：
```typescript
import React, { useState } from 'react';
import Header from './components/Header';
import PlatformSelector from './components/PlatformSelector';
import { Platform } from './types';
import { generatePlan, getDownloadUrl } from './services/apiService';
import { Loader2, Download, Sparkles, Wand2, FileCheck } from 'lucide-react';

const App: React.FC = () => {
  const [shopName, setShopName] = useState('');
  const [platform, setPlatform] = useState<Platform>(Platform.ELEME);
  const [isLoading, setIsLoading] = useState(false);
  const [downloadUrl, setDownloadUrl] = useState<string | null>(null);
  const [filename, setFilename] = useState<string>('');
  const [error, setError] = useState<string | null>(null);

  const handleGenerate = async () => {
    if (!shopName.trim()) {
      setError("请输入店铺名称");
      return;
    }

    setIsLoading(true);
    setError(null);
    setDownloadUrl(null);

    try {
      const result = await generatePlan(shopName, platform);
      if (result.success) {
        setDownloadUrl(getDownloadUrl(result.download_url));
        setFilename(result.filename);
      }
    } catch (err: any) {
      setError(err.message || "生成失败，请重试");
    } finally {
      setIsLoading(false);
    }
  };

  const handleDownload = () => {
    if (downloadUrl) {
      window.open(downloadUrl, '_blank');
    }
  };

  return (
    <div className="min-h-screen bg-slate-50 flex flex-col">
      <Header />
      <main className="flex-grow max-w-4xl mx-auto w-full px-4 py-8">
        {/* 表单区域 */}
        <div className="bg-white rounded-2xl p-6 shadow-sm border">
          <h2 className="text-lg font-bold mb-4 flex items-center gap-2">
            <Wand2 className="text-primary-500" size={20} />
            创建活动方案
          </h2>

          {/* 店铺名输入 */}
          <div className="mb-6">
            <label className="block text-sm font-medium mb-2">店铺名称</label>
            <input
              type="text"
              value={shopName}
              onChange={(e) => setShopName(e.target.value)}
              placeholder="例如：逸莹麻辣串串香(仲景市集店)"
              className="w-full px-4 py-3 border rounded-xl"
            />
          </div>

          {/* 平台选择 */}
          <div className="mb-6">
            <label className="block text-sm font-medium mb-3">目标平台</label>
            <PlatformSelector selected={platform} onChange={setPlatform} />
          </div>

          {/* 错误提示 */}
          {error && (
            <div className="p-4 rounded-xl bg-red-50 text-red-600 text-sm mb-4">
              {error}
            </div>
          )}

          {/* 生成按钮 */}
          <button
            onClick={handleGenerate}
            disabled={isLoading || !shopName.trim()}
            className="w-full py-3.5 rounded-xl font-semibold text-white bg-primary-600"
          >
            {isLoading ? (
              <><Loader2 className="animate-spin inline mr-2" />正在生成...</>
            ) : (
              <><Sparkles className="inline mr-2" />立即生成方案</>
            )}
          </button>
        </div>

        {/* 下载区域 */}
        {downloadUrl && (
          <div className="mt-6 bg-green-50 rounded-2xl p-6 border border-green-200">
            <div className="flex items-center gap-3 mb-4">
              <FileCheck className="text-green-600" size={24} />
              <span className="font-bold text-green-800">方案生成成功！</span>
            </div>
            <p className="text-sm text-green-700 mb-4">文件名: {filename}</p>
            <button
              onClick={handleDownload}
              className="px-6 py-3 bg-green-600 text-white rounded-xl"
            >
              <Download className="inline mr-2" size={18} />
              下载 PDF 文件
            </button>
          </div>
        )}
      </main>
    </div>
  );
};

export default App;
```

### 6.6 Header 组件改造

**components/Header.tsx** - 移除 "AI 驱动" 标签
```typescript
import React from 'react';
import { Zap } from 'lucide-react';

const Header: React.FC = () => {
  return (
    <nav className="w-full bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between items-center h-16">
          <div className="flex items-center gap-2">
            <div className="bg-gradient-to-br from-primary-500 to-secondary-500 text-white p-1.5 rounded-lg">
              <Zap size={20} fill="currentColor" />
            </div>
            <span className="font-bold text-xl tracking-tight text-slate-800">
              呈尚<span className="text-slate-400">策划</span>
            </span>
            {/* 移除 AI 驱动标签，改为专业外卖运营 */}
            <span className="hidden md:inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-50 text-primary-700 ml-2">
              专业外卖运营
            </span>
          </div>
          <div className="flex items-center gap-4">
            <span className="text-sm text-slate-400">v3.0.0</span>
          </div>
        </div>
      </div>
    </nav>
  );
};

export default Header;
```

### 6.7 Vite 配置改造

**vite.config.ts** - 移除 GEMINI_API_KEY
```typescript
import path from 'path';
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  server: {
    port: 3000,
    host: '0.0.0.0',
    // 开发时代理后端 API
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
      },
      '/files': {
        target: 'http://localhost:8000',
        changeOrigin: true,
      },
    },
  },
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, '.'),
    },
  },
});
```

### 6.8 环境变量配置

**.env.local**
```bash
# 后端 API 地址 (生产环境配置)
VITE_API_BASE=http://localhost:8000
```

### 6.9 需要删除的文件

```bash
# 删除不再需要的 Gemini 服务
rm services/geminiService.ts
```

---

## 7. API接口设计

### 7.1 接口列表

| 方法 | 路径 | 描述 |
|-----|------|------|
| POST | `/api/generate` | 生成 PDF 文档 |
| GET | `/api/download/{filename}` | 下载 PDF 文件 |
| GET | `/api/health` | 健康检查 |
| GET | `/files/{filename}` | 静态文件访问 |

### 7.2 生成 PDF 接口

**请求**
```http
POST /api/generate
Content-Type: application/json

{
  "store_name": "逸莹麻辣串串香(仲景市集店)",
  "platform": "eleme"
}
```

**参数说明**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| store_name | string | 是 | 店铺名称 |
| platform | string | 是 | 平台类型: `eleme` / `meituan` / `both` |

**响应 - 成功**
```json
{
  "success": true,
  "filename": "逸莹麻辣串串香(仲景市集店)_饿了么活动方案.pdf",
  "download_url": "/files/逸莹麻辣串串香(仲景市集店)_饿了么活动方案.pdf"
}
```

**响应 - 失败**
```json
{
  "detail": "店铺名称不能为空"
}
```

### 7.3 完整流程时序图

```
用户                    前端                      后端
 │                       │                        │
 │  1.输入店铺名          │                        │
 │ ─────────────────────>│                        │
 │                       │                        │
 │  2.选择平台            │                        │
 │ ─────────────────────>│                        │
 │                       │                        │
 │  3.点击生成            │                        │
 │ ─────────────────────>│  4.POST /api/generate  │
 │                       │ ───────────────────────>│
 │                       │                        │ 5.读取内置模板
 │                       │                        │ 6.reportlab渲染
 │                       │                        │ 7.保存PDF文件
 │                       │  8.返回下载链接         │
 │                       │ <───────────────────────│
 │  9.显示下载按钮        │                        │
 │ <─────────────────────│                        │
 │                       │                        │
 │  10.点击下载           │  11.GET /files/xxx.pdf │
 │ ─────────────────────>│ ───────────────────────>│
 │                       │                        │
 │  12.保存PDF文件        │  13.返回PDF文件        │
 │ <─────────────────────│ <───────────────────────│
```

---

## 8. GitHub Actions 部署

### 8.1 部署方案概述

GitHub Actions 可用于两种场景：

| 场景 | 说明 | 触发方式 |
|-----|------|---------|
| **命令行生成** | 直接运行 Python 脚本生成 PDF | workflow_dispatch 手动触发 |
| **Web 服务部署** | 部署完整前后端服务 | push 触发 |

### 8.2 命令行生成工作流

**.github/workflows/generate-pdf.yml**
```yaml
name: Generate Activity Plan PDF

on:
  workflow_dispatch:
    inputs:
      store_name:
        description: '店铺名称'
        required: true
        type: string
        default: '示例店铺'
      platform:
        description: '目标平台'
        required: true
        type: choice
        options:
          - eleme
          - meituan
          - both

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # 关键步骤：安装中文字体
      - name: Install Chinese fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y fonts-wqy-microhei fonts-wqy-zenhei
          fc-cache -fv

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install reportlab

      - name: Generate PDF
        run: |
          python backend/app/services/pdf_generator.py \
            "${{ inputs.store_name }}" \
            "${{ inputs.platform }}" \
            ./output

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: activity-plan-${{ inputs.platform }}
          path: ./output/*.pdf
          retention-days: 7
```

### 8.3 字体处理说明

GitHub Actions 使用 Ubuntu 环境，默认没有中文字体。必须安装字体才能正确渲染中文。

**安装命令**
```bash
sudo apt-get install -y fonts-wqy-microhei fonts-wqy-zenhei
fc-cache -fv
```

**字体路径**
安装后字体位于：`/usr/share/fonts/truetype/wqy/wqy-microhei.ttc`

**代码适配**
`pdf_generator.py` 中已包含 Linux 字体路径：
```python
("/usr/share/fonts/truetype/wqy/wqy-microhei.ttc", "WQY"),
```

### 8.4 批量生成工作流

**.github/workflows/batch-generate.yml**
```yaml
name: Batch Generate PDFs

on:
  workflow_dispatch:
    inputs:
      stores_json:
        description: '店铺列表 JSON (格式: [{"name":"店铺1","platform":"eleme"}])'
        required: true
        type: string

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Chinese fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y fonts-wqy-microhei
          fc-cache -fv

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install reportlab

      - name: Generate PDFs
        run: |
          echo '${{ inputs.stores_json }}' | python -c "
          import json, sys
          sys.path.insert(0, 'backend/app/services')
          from pdf_generator import generate_plan
          stores = json.load(sys.stdin)
          for s in stores:
              generate_plan(s['name'], s['platform'], './output')
          "

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: batch-pdfs
          path: ./output/*.pdf
```

---

## 9. 开发计划与任务清单

### 9.1 阶段一：后端开发

| 序号 | 任务 | 优先级 | 状态 |
|-----|------|-------|------|
| 1.1 | 创建 backend 目录结构 | P0 | 待开始 |
| 1.2 | 复制 pdf_generator.py 核心代码 | P0 | 待开始 |
| 1.3 | 创建 activity_templates.py 数据模板 | P0 | 待开始 |
| 1.4 | 实现 FastAPI 主入口 main.py | P0 | 待开始 |
| 1.5 | 实现 API 路由 routes.py | P0 | 待开始 |
| 1.6 | 创建 requirements.txt | P1 | 待开始 |
| 1.7 | 本地测试 PDF 生成功能 | P0 | 待开始 |

### 9.2 阶段二：前端改造

| 序号 | 任务 | 优先级 | 状态 |
|-----|------|-------|------|
| 2.1 | 更新 types.ts 类型定义 | P0 | 待开始 |
| 2.2 | 创建 apiService.ts 替换 geminiService | P0 | 待开始 |
| 2.3 | 改造 PlatformSelector.tsx (饿了么/美团) | P0 | 待开始 |
| 2.4 | 改造 App.tsx 主组件 | P0 | 待开始 |
| 2.5 | 改造 Header.tsx 移除 AI 标签 | P1 | 待开始 |
| 2.6 | 更新 vite.config.ts 配置 | P1 | 待开始 |
| 2.7 | 删除 geminiService.ts | P1 | 待开始 |
| 2.8 | 更新 .env.local 环境变量 | P1 | 待开始 |

### 9.3 阶段三：集成测试

| 序号 | 任务 | 优先级 | 状态 |
|-----|------|-------|------|
| 3.1 | 前后端联调测试 | P0 | 待开始 |
| 3.2 | 饿了么平台 PDF 生成测试 | P0 | 待开始 |
| 3.3 | 美团平台 PDF 生成测试 | P0 | 待开始 |
| 3.4 | 双平台 PDF 生成测试 | P0 | 待开始 |
| 3.5 | PDF 下载功能测试 | P0 | 待开始 |
| 3.6 | 错误处理测试 | P1 | 待开始 |

### 9.4 阶段四：GitHub Actions 部署

| 序号 | 任务 | 优先级 | 状态 |
|-----|------|-------|------|
| 4.1 | 创建 generate-pdf.yml 工作流 | P0 | 待开始 |
| 4.2 | 测试单个 PDF 生成 | P0 | 待开始 |
| 4.3 | 创建 batch-generate.yml 批量工作流 | P1 | 待开始 |
| 4.4 | 测试批量生成功能 | P1 | 待开始 |
| 4.5 | 验证中文字体渲染 | P0 | 待开始 |

---

## 10. 附录

### 10.1 本地开发启动命令

```bash
# 1. 启动后端 (终端1)
cd backend
pip install -r requirements.txt
python run.py
# 后端运行在 http://localhost:8000

# 2. 启动前端 (终端2)
cd frontend
npm install
npm run dev
# 前端运行在 http://localhost:3000
```

### 10.2 PDF 输出文件命名规则

| 平台 | 文件名格式 |
|-----|-----------|
| 饿了么 | `{店铺名}_饿了么活动方案.pdf` |
| 美团 | `{店铺名}_美团活动方案.pdf` |
| 双平台 | `{店铺名}_双平台活动方案.pdf` |

### 10.3 常见问题

**Q1: PDF 中文显示为方块或乱码？**
- 原因：缺少中文字体
- 解决：安装 `fonts-wqy-microhei` 或将字体文件放入 `fonts/` 目录

**Q2: 前端无法连接后端？**
- 检查后端是否运行在 8000 端口
- 检查 CORS 配置是否正确
- 检查 vite.config.ts 代理配置

**Q3: GitHub Actions 生成失败？**
- 检查是否安装了中文字体
- 检查 Python 版本是否为 3.11+
- 查看 Actions 日志定位错误

### 10.4 参考资源

| 资源 | 链接 |
|-----|------|
| reportlab 文档 | https://docs.reportlab.com/ |
| FastAPI 文档 | https://fastapi.tiangolo.com/ |
| Vite 文档 | https://vitejs.dev/ |
| GitHub Actions | https://docs.github.com/actions |

---

## 更新日志

| 版本 | 日期 | 更新内容 |
|-----|------|---------|
| v3.0 | 2026-01-28 | 重构架构，移除 Gemini API，改用内置模板 |
| v2.0 | - | 基于 Gemini API 的动态生成方案 |
| v1.0 | - | 初始版本 |

---

**文档结束**
